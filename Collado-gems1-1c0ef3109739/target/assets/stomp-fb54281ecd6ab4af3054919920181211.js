(function(){var e,t,n,r,i={}.hasOwnProperty,s=[].slice;e={LF:"\n",NULL:"\0"};n=function(){function n(e,t,n){this.command=e;this.headers=t!=null?t:{};this.body=n!=null?n:""}var t;n.prototype.toString=function(){var t,r,s,o;t=[this.command];o=this.headers;for(r in o){if(!i.call(o,r))continue;s=o[r];t.push(""+r+":"+s)}if(this.body){t.push("content-length:"+n.sizeOfUTF8(this.body))}t.push(e.LF+this.body);return t.join(e.LF)};n.sizeOfUTF8=function(e){if(e){return encodeURI(e).split(/%..|./).length-1}else{return 0}};t=function(t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;o=t.search(RegExp(""+e.LF+e.LF));u=t.substring(0,o).split(e.LF);s=u.shift();a={};d=function(e){return e.replace(/^\s+|\s+$/g,"")};y=u.reverse();for(v=0,g=y.length;v<g;v++){h=y[v];l=h.indexOf(":");a[d(h.substring(0,l))]=d(h.substring(l+1))}r="";p=o+2;if(a["content-length"]){c=parseInt(a["content-length"]);r=(""+t).substring(p,p+c)}else{i=null;for(f=m=p,b=t.length;p<=b?m<b:m>b;f=p<=b?++m:--m){i=t.charAt(f);if(i===e.NULL){break}r+=i}}return new n(s,a,r)};n.unmarshall=function(n){var r;return function(){var i,s,o,u;o=n.split(RegExp(""+e.NULL+e.LF+"*"));u=[];for(i=0,s=o.length;i<s;i++){r=o[i];if((r!=null?r.length:void 0)>0){u.push(t(r))}}return u}()};n.marshall=function(t,r,i){var s;s=new n(t,r,i);return s.toString()+e.NULL};return n}();t=function(){function i(e){this.ws=e;this.ws.binaryType="arraybuffer";this.counter=0;this.connected=false;this.heartbeat={outgoing:1e4,incoming:1e4};this.maxWebSocketFrameSize=16*1024;this.subscriptions={}}var t;i.prototype.debug=function(e){var t;return typeof window!=="undefined"&&window!==null?(t=window.console)!=null?t.log(e):void 0:void 0};t=function(){return Date.now||(new Date).valueOf};i.prototype._transmit=function(e,t,r){var i;i=n.marshall(e,t,r);if(typeof this.debug==="function"){this.debug(">>> "+i)}while(true){if(i.length>this.maxWebSocketFrameSize){this.ws.send(i.substring(0,this.maxWebSocketFrameSize));i=i.substring(this.maxWebSocketFrameSize);if(typeof this.debug==="function"){this.debug("remaining = "+i.length)}}else{return this.ws.send(i)}}};i.prototype._setupHeartbeat=function(n){var i,s,o,u,a,f,l=this;if((a=n.version)!==r.VERSIONS.V1_1&&a!==r.VERSIONS.V1_2){return}f=function(){var e,t,r,i;r=n["heart-beat"].split(",");i=[];for(e=0,t=r.length;e<t;e++){u=r[e];i.push(parseInt(u))}return i}(),s=f[0],i=f[1];if(!(this.heartbeat.outgoing===0||i===0)){o=Math.max(this.heartbeat.outgoing,i);if(typeof this.debug==="function"){this.debug("send PING every "+o+"ms")}this.pinger=r.setInterval(o,function(){l.ws.send(e.LF);return typeof l.debug==="function"?l.debug(">>> PING"):void 0})}if(!(this.heartbeat.incoming===0||s===0)){o=Math.max(this.heartbeat.incoming,s);if(typeof this.debug==="function"){this.debug("check PONG every "+o+"ms")}return this.ponger=r.setInterval(o,function(){var e;e=t()-l.serverActivity;if(e>o*2){if(typeof l.debug==="function"){l.debug("did not receive server activity for the last "+e+"ms")}return l.ws.close()}})}};i.prototype._parseConnect=function(){var e,t,n,r;e=1<=arguments.length?s.call(arguments,0):[];r={};switch(e.length){case 2:r=e[0],t=e[1];break;case 3:if(e[1]instanceof Function){r=e[0],t=e[1],n=e[2]}else{r.login=e[0],r.passcode=e[1],t=e[2]}break;case 4:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3];break;default:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3],r.host=e[4]}return[r,t,n]};i.prototype.connect=function(){var i,o,u,a,f=this;i=1<=arguments.length?s.call(arguments,0):[];a=this._parseConnect.apply(this,i);u=a[0],this.connectCallback=a[1],o=a[2];if(typeof this.debug==="function"){this.debug("Opening Web Socket...")}this.ws.onmessage=function(r){var i,s,u,a,l,c,h,p,d,v,m,g;a=typeof ArrayBuffer!=="undefined"&&r.data instanceof ArrayBuffer?(i=new Uint8Array(r.data),typeof f.debug==="function"?f.debug("--- got data length: "+i.length):void 0,function(){var e,t,n;n=[];for(e=0,t=i.length;e<t;e++){s=i[e];n.push(String.fromCharCode(s))}return n}().join("")):r.data;f.serverActivity=t();if(a===e.LF){if(typeof f.debug==="function"){f.debug("<<< PONG")}return}if(typeof f.debug==="function"){f.debug("<<< "+a)}m=n.unmarshall(a);g=[];for(d=0,v=m.length;d<v;d++){l=m[d];switch(l.command){case"CONNECTED":if(typeof f.debug==="function"){f.debug("connected to server "+l.headers.server)}f.connected=true;f._setupHeartbeat(l.headers);g.push(typeof f.connectCallback==="function"?f.connectCallback(l):void 0);break;case"MESSAGE":p=l.headers.subscription;h=f.subscriptions[p]||f.onreceive;if(h){u=f;c=l.headers["message-id"];l.ack=function(e){if(e==null){e={}}return u.ack(c,p,e)};l.nack=function(e){if(e==null){e={}}return u.nack(c,p,e)};g.push(h(l))}else{g.push(typeof f.debug==="function"?f.debug("Unhandled received MESSAGE: "+l):void 0)}break;case"RECEIPT":g.push(typeof f.onreceipt==="function"?f.onreceipt(l):void 0);break;case"ERROR":g.push(typeof o==="function"?o(l):void 0);break;default:g.push(typeof f.debug==="function"?f.debug("Unhandled frame: "+l):void 0)}}return g};this.ws.onclose=function(){var e;e="Whoops! Lost connection to "+f.ws.url;if(typeof f.debug==="function"){f.debug(e)}f._cleanUp();return typeof o==="function"?o(e):void 0};return this.ws.onopen=function(){if(typeof f.debug==="function"){f.debug("Web Socket Opened...")}u["accept-version"]=r.VERSIONS.supportedVersions();u["heart-beat"]=[f.heartbeat.outgoing,f.heartbeat.incoming].join(",");return f._transmit("CONNECT",u)}};i.prototype.disconnect=function(e){this._transmit("DISCONNECT");this.ws.onclose=null;this.ws.close();this._cleanUp();return typeof e==="function"?e():void 0};i.prototype._cleanUp=function(){this.connected=false;if(this.pinger){r.clearInterval(this.pinger)}if(this.ponger){return r.clearInterval(this.ponger)}};i.prototype.send=function(e,t,n){if(t==null){t={}}if(n==null){n=""}t.destination=e;return this._transmit("SEND",t,n)};i.prototype.subscribe=function(e,t,n){var r;if(n==null){n={}}if(!n.id){n.id="sub-"+this.counter++}n.destination=e;this.subscriptions[n.id]=t;this._transmit("SUBSCRIBE",n);r=this;return{id:n.id,unsubscribe:function(){return r.unsubscribe(n.id)}}};i.prototype.unsubscribe=function(e){delete this.subscriptions[e];return this._transmit("UNSUBSCRIBE",{id:e})};i.prototype.begin=function(e){var t,n;n=e||"tx-"+this.counter++;this._transmit("BEGIN",{transaction:n});t=this;return{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}};i.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})};i.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})};i.prototype.ack=function(e,t,n){if(n==null){n={}}n["message-id"]=e;n.subscription=t;return this._transmit("ACK",n)};i.prototype.nack=function(e,t,n){if(n==null){n={}}n["message-id"]=e;n.subscription=t;return this._transmit("NACK",n)};return i}();r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,n){var i,s;if(n==null){n=["v10.stomp","v11.stomp"]}i=r.WebSocketClass||WebSocket;s=new i(e,n);return new t(s)},over:function(e){return new t(e)},Frame:n};if(typeof window!=="undefined"&&window!==null){r.setInterval=function(e,t){return window.setInterval(t,e)};r.clearInterval=function(e){return window.clearInterval(e)};window.Stomp=r}else if(typeof exports!=="undefined"&&exports!==null){exports.Stomp=r}else{self.Stomp=r}}).call(this)